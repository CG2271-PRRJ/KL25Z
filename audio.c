#include "audio.h"

volatile int currNoteAlt = 0;

// int melody[] = {
//     N_D3,
//     N_D3,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_C3,
//     N_C3,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_B2,
//     N_B2,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_AS2,
//     N_AS2,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_D3,
//     N_D3,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_C3,
//     N_C3,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_B2,
//     N_B2,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_AS2,
//     N_AS2,
//     N_D4,
//     N_A3,
//     0,
//     N_GS3,
//     N_G3,
//     N_F3,
//     N_D3,
//     N_F3,
//     N_G3,
//     N_D4,
//     N_D4,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_C4,
//     N_C4,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_B3,
//     N_B3,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_AS3,
//     N_AS3,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_D4,
//     N_D4,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_C4,
//     N_C4,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_B3,
//     N_B3,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_AS3,
//     N_AS3,
//     N_D5,
//     N_A4,
//     0,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_D4,
//     N_D4,
//     N_D4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_G4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     0,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_G4,
//     N_GS4,
//     N_A4,
//     N_C5,
//     N_A4,
//     N_D5,
//     N_D5,
//     N_D5,
//     N_A4,
//     N_D5,
//     N_C5,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_D4,
//     N_D4,
//     N_D4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_E4,
//     N_D4,
//     N_C4,
//     0,
//     N_G4,
//     N_E4,
//     N_D4,
//     N_D4,
//     N_D4,
//     N_D4,
//     N_F3,
//     N_G3,
//     N_AS3,
//     N_C4,
//     N_D4,
//     N_F4,
//     N_C5,
//     0,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_GS4,
//     N_A4,
//     N_C5,
//     N_A4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_E4,
//     N_F4,
//     N_G4,
//     N_A4,
//     N_C5,
//     N_CS5,
//     N_GS4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_G4,
//     N_F3,
//     N_G3,
//     N_A3,
//     N_F4,
//     N_E4,
//     N_D4,
//     N_E4,
//     N_F4,
//     N_G4,
//     N_E4,
//     N_A4,
//     N_A4,
//     N_G4,
//     N_F4,
//     N_DS4,
//     N_CS4,
//     N_DS4,
//     0,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_G4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_F4,
//     N_F4,
//     N_F4,
//     N_GS4,
//     N_A4,
//     N_C5,
//     N_A4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_D4,
//     N_E4,
//     N_F4,
//     N_G4,
//     N_A4,
//     N_C5,
//     N_CS5,
//     N_GS4,
//     N_GS4,
//     N_G4,
//     N_F4,
//     N_G4,
//     N_F3,
//     N_G3,
//     N_A3,
//     N_F4,
//     N_E4,
//     N_D4,
//     N_E4,
//     N_F4,
//     N_G4,
//     N_E4,
//     N_A4,
//     N_A4,
//     N_G4,
//     N_F4,
//     N_DS4,
//     N_CS4,
//     N_DS4,
// };

// int noteDurations[] = {
//     16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 16, 16, 8, 6, 32, 8, 8, 8, 16, 16, 16, 8, 16, 8, 8, 8, 8, 4, 16, 8, 16, 8, 8, 8, 16, 16, 16, 16, 16, 8, 8, 16, 8, 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 2, 8, 16, 8, 8, 8, 8, 4, 16, 8, 16, 8, 8, 8, 8, 8, 16, 8, 16, 8, 8, 8, 8, 8, 8, 8, 16, 8, 15, 8, 8, 2, 3, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 8, 2, 16, 8, 16, 8, 16, 16, 16, 16, 16, 16, 8, 8, 8, 8, 8, 8, 16, 16, 16, 2, 8, 8, 8, 8, 4, 4, 4, 4, 4, 4, 2, 8, 8, 8, 8, 2, 2, 3, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 8, 2, 16, 8, 16, 8, 16, 16, 16, 16, 16, 16, 8, 8, 8, 8, 8, 8, 16, 16, 16, 2, 8, 8, 8, 8, 4, 4, 4, 4, 4, 4, 2, 8, 8, 8, 8, 2, 1};

int melody[] = {
    NOTE_A5,
    NOTE_B5,
    NOTE_C6,
    NOTE_D6,
};

int durations[] = {
    4, 4, 4, 4};
void setNote(uint32_t freq)
{
    if (freq == 0)
    {
        stopNote();
        return;
    }
    uint32_t mod = (375000 / (freq));
    TPM0->MOD = mod;
    TPM0_C5V = mod / VOLUME;
}

void stopNote(void)
{
    TPM0_C5V = 0;
}

uint16_t changeNoteAlt(void)
{
    setNote(melody[currNoteAlt]);

    // calculate delay based on tempo and note length
    uint16_t note_length = durations[currNoteAlt];
    uint16_t delay = (uint16_t)((double)(TEMPO / note_length) * 1.45);

    currNoteAlt = (currNoteAlt + 1) % (sizeof(melody) / sizeof(int));
    return delay;
}
